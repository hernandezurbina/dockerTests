<!DOCTYPE html>
<html>
  <head>
    <title>NTG</title>
  	<meta charset="utf-8" />
  	{% load staticfiles %}
  	<link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}" type = "text/css"/>
  	<meta name="viewport" content = "width=device-width, initial-scale=1.0">

  	<style type="text/css">
  		html,
  		body {
  		  height:100%
  		}
  	</style>
    <script>
      function initMap() {
        var ox = {lat: 51.752013, lng: -1.257850};
        var map = new google.maps.Map(document.getElementById('map'), {
          zoom: 3,
          center: ox,
          mapTypeId: google.maps.MapTypeId.TERRAIN,
        });
        // var marker = new google.maps.Marker({
        //   position: ox,
        //   map: map
        // });

        {% if results %}
          {% for row in results %}
            var marker = new google.maps.Marker({
               position: {lat: {{row.latitude}}, lng: {{row.longitude}}},
               map: map
            });
            marker['infowindow']  = new google.maps.InfoWindow({
                    content: "<h6>{{row.affiliation}}</h6>",
            });
            google.maps.event.addListener(marker, 'click', function() {
                this['infowindow'].open(map, this);
            });
          {% endfor %}
        {% endif %}

      }
    </script>
    <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDBvDdltwG60Tg-9hY_1DOO2q9g0tojQqc&callback=initMap">
    </script>
    <style>
       #map {
        height: 500px;
        width: 100%;
       }
    </style>
  </head>
  <body>
    <div class="container">
        <div class="row">
            <div class="col-md-6 col-md-offset-3">
                <h1>Search by keyword</h1>
            </div>
        </div>
        <div class="row">
            <div class="col-md-4 col-md-offset-3">
  						<form action="map" method="post">
  								{% csrf_token %}
  						    {{ form }}
  								<br>
  						    <input type="submit" value="Submit" />
  						</form>
            </div>
        </div>
        <div class="row">&nbsp;</div>
        <div class="row">
          <div id="map"></div>
        </div>
    </div>

    {% if results %}
    	<div class="section">
        <h4 class="gradient">Results:</h4>
        <ul>
            {% for row in results %}
              <li>{{ row.affiliation }} : {{row.city}}, {{row.country}} LONGITUDE: {{row.longitude}} LATITUDE: {{row.latitude}}</li>
            {% endfor %}
        </ul>
      </div>
    {% endif %}
  </body>
</html>
